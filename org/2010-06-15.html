<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Why we thought we could use triggers this time</title>
<!-- 2015-03-29 Sun 18:05 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="rydnr" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Why we thought we could use triggers this time</h1>
---
layout: post
title: Why we thought we could use triggers this time
date: 2010-06-15
categories: 
- 
author: rydnr
excerpt: 
---
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Why we thought we could use triggers this time</h2>
<div class="outline-text-2" id="text-1">
<p>
Hi,
</p>

<p>
After a conversation with JÃ¶rg when he requested information about why we used triggers, it probably makes sense to spread it. First, to preserve my reputation regarding the role of databases :), and second, to make sure the path we took was a decision based on what we considered best in terms of costs/benefits, and risks. It was definitely not a matter of taste.
</p>

<p>
The rationale behind this is the following. The customer, product and site limits were implemented already, but the requirements changed. So we refactored that logic last sprint, keeping our 'beloved' Alinghi component design: BL/service, DB/DAO, and of course an Oracle instance underneath. But in this sprint we had a requirement which on the surface didn't mean much, but in reality was a dramatic change at several levels.
</p>

<p>
The change was stated saying that the limits can only be changed by sysadmins, who (to my surprise) have the right to use its own tool and only such tool. We were told that the limits (site and product) had to be migrated as properties in property-mgmt. We couldn't convince anyone that it'd be more reasonable to use a special role in the backoffice. We're now serving sysadmins!!! ;)
</p>

<p>
So we internally proposed several options.
</p>
<ul class="org-ul">
<li>Refactoring of all DB/BL/DAO to split into Oracle vs PM properties. Huge change, which made this change visible to every piece of 'client' code.
</li>
<li>Heterogeneous DAO/DB, keeping BLs intact. Lot of unexpected noise in the otherwise transparent persistence layer, not to mention the failure to preserve transactions.
</li>
<li>Using directly the DB backend of PM, and use views. We didn't try, but could work since the limits are read-only from the BO.
</li>
<li>Synchronizing limit information via triggers. The source is always PM, so the synchronization is one-way-only.
</li>
</ul>

<p>
As we've just noticed, we have reasons not to believe new requirements of limits inside PM are here to stay. We find much more reasonable to design based on the concepts than on the convenience of who will use it. With that in mind, our decision was to start with the trigger solution, which is the cheapest and less risky by far. We'll adapt the solution as circumstances evolve.
</p>

<p>
But as a general rule we always avoid triggers as much as possible. This time, however, as ugly as it seems, it's the prettiest of the candidates. Well, it'd be much better to keep using the same design as before, or if necessary (and possible in terms of dependencies) register PM hooks to update the values. But that would have been the same synchronization mechanism, this time using application logic instead of triggers.
</p>

<p>
As a summary, you won't find trigger advocates here, just people who couldn't convince (despite all our efforts) and decided the better solution under the circumstances.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2010-06-15</p>
<p class="author">Author: rydnr</p>
<p class="date">Created: 2015-03-29 Sun 18:05</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.4.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
